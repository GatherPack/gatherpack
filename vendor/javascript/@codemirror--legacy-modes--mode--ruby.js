function wordObj(e){var t={};for(var n=0,r=e.length;n<r;++n)t[e[n]]=true;return t}var e=["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"],t=wordObj(e);var n=wordObj(["def","class","case","for","while","until","module","catch","loop","proc","begin"]);var r=wordObj(["end","until"]);var a={"[":"]","{":"}","(":")"};var i={"]":"[","}":"{",")":"("};var o;function chain(e,t,n){n.tokenize.push(e);return e(t,n)}function tokenBase(e,t){if(e.sol()&&e.match("=begin")&&e.eol()){t.tokenize.push(readBlockComment);return"comment"}if(e.eatSpace())return null;var n,r=e.next();if(r=="`"||r=="'"||r=='"')return chain(readQuoted(r,"string",r=='"'||r=="`"),e,t);if(r=="/")return regexpAhead(e)?chain(readQuoted(r,"string.special",true),e,t):"operator";if(r=="%"){var i="string",u=true;if(e.eat("s"))i="atom";else if(e.eat(/[WQ]/))i="string";else if(e.eat(/[r]/))i="string.special";else if(e.eat(/[wxq]/)){i="string";u=false}var l=e.eat(/[^\w\s=]/);if(!l)return"operator";a.propertyIsEnumerable(l)&&(l=a[l]);return chain(readQuoted(l,i,u,true),e,t)}if(r=="#"){e.skipToEnd();return"comment"}if(r=="<"&&(n=e.match(/^<([-~])[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return chain(readHereDoc(n[2],n[1]),e,t);if(r=="0"){e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/);return"number"}if(/\d/.test(r)){e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}if(r=="?"){while(e.match(/^\\[CM]-/));e.eat("\\")?e.eatWhile(/\w/):e.next();return"string"}if(r==":"){if(e.eat("'"))return chain(readQuoted("'","atom",false),e,t);if(e.eat('"'))return chain(readQuoted('"',"atom",true),e,t);if(e.eat(/[\<\>]/)){e.eat(/[\<\>]/);return"atom"}if(e.eat(/[\+\-\*\/\&\|\:\!]/))return"atom";if(e.eat(/[a-zA-Z$@_\xa1-\uffff]/)){e.eatWhile(/[\w$\xa1-\uffff]/);e.eat(/[\?\!\=]/);return"atom"}return"operator"}if(r=="@"&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/)){e.eat("@");e.eatWhile(/[\w\xa1-\uffff]/);return"propertyName"}if(r=="$"){e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next();return"variableName.special"}if(/[a-zA-Z_\xa1-\uffff]/.test(r)){e.eatWhile(/[\w\xa1-\uffff]/);e.eat(/[\?\!]/);return e.eat(":")?"atom":"variable"}if(r!="|"||!t.varList&&t.lastTok!="{"&&t.lastTok!="do"){if(/[\(\)\[\]{}\\;]/.test(r)){o=r;return null}if(r=="-"&&e.eat(">"))return"operator";if(/[=+\-\/*:\.^%<>~|]/.test(r)){var f=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);r!="."||f||(o=".");return"operator"}return null}o="|";return null}function regexpAhead(e){var t,n=e.pos,r=0,a=false,i=false;while((t=e.next())!=null)if(i)i=false;else{if("[{(".indexOf(t)>-1)r++;else if("]})".indexOf(t)>-1){r--;if(r<0)break}else if(t=="/"&&r==0){a=true;break}i=t=="\\"}e.backUp(e.pos-n);return a}function tokenBaseUntilBrace(e){e||(e=1);return function(t,n){if(t.peek()=="}"){if(e==1){n.tokenize.pop();return n.tokenize[n.tokenize.length-1](t,n)}n.tokenize[n.tokenize.length-1]=tokenBaseUntilBrace(e-1)}else t.peek()=="{"&&(n.tokenize[n.tokenize.length-1]=tokenBaseUntilBrace(e+1));return tokenBase(t,n)}}function tokenBaseOnce(){var e=false;return function(t,n){if(e){n.tokenize.pop();return n.tokenize[n.tokenize.length-1](t,n)}e=true;return tokenBase(t,n)}}function readQuoted(e,t,n,r){return function(a,i){var o,u=false;if(i.context.type==="read-quoted-paused"){i.context=i.context.prev;a.eat("}")}while((o=a.next())!=null){if(o==e&&(r||!u)){i.tokenize.pop();break}if(n&&o=="#"&&!u){if(a.eat("{")){e=="}"&&(i.context={prev:i.context,type:"read-quoted-paused"});i.tokenize.push(tokenBaseUntilBrace());break}if(/[@\$]/.test(a.peek())){i.tokenize.push(tokenBaseOnce());break}}u=!u&&o=="\\"}return t}}function readHereDoc(e,t){return function(n,r){t&&n.eatSpace();n.match(e)?r.tokenize.pop():n.skipToEnd();return"string"}}function readBlockComment(e,t){e.sol()&&e.match("=end")&&e.eol()&&t.tokenize.pop();e.skipToEnd();return"comment"}const u={name:"ruby",startState:function(e){return{tokenize:[tokenBase],indented:0,context:{type:"top",indented:-e},continuedLine:false,lastTok:null,varList:false}},token:function(e,a){o=null;e.sol()&&(a.indented=e.indentation());var i,u=a.tokenize[a.tokenize.length-1](e,a);var l=o;if(u=="variable"){var f=e.current();u=a.lastTok=="."?"property":t.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(f)?"tag":a.lastTok=="def"||a.lastTok=="class"||a.varList?"def":"variable";if(u=="keyword"){l=f;n.propertyIsEnumerable(f)?i="indent":r.propertyIsEnumerable(f)?i="dedent":f!="if"&&f!="unless"||e.column()!=e.indentation()?f=="do"&&a.context.indented<a.indented&&(i="indent"):i="indent"}}(o||u&&u!="comment")&&(a.lastTok=l);o=="|"&&(a.varList=!a.varList);i=="indent"||/[\(\[\{]/.test(o)?a.context={prev:a.context,type:o||u,indented:a.indented}:(i=="dedent"||/[\)\]\}]/.test(o))&&a.context.prev&&(a.context=a.context.prev);e.eol()&&(a.continuedLine=o=="\\"||u=="operator");return u},indent:function(e,t,n){if(e.tokenize[e.tokenize.length-1]!=tokenBase)return null;var r=t&&t.charAt(0);var a=e.context;var o=a.type==i[r]||a.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(t);return a.indented+(o?0:n.unit)+(e.continuedLine?n.unit:0)},languageData:{indentOnInput:/^\s*(?:end|rescue|elsif|else|\})$/,commentTokens:{line:"#"},autocomplete:e}};export{u as ruby};

